<!doctype html>
<html lang="es">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Security-Policy" content="default-src 'self' https: data: 'unsafe-inline' 'unsafe-eval'">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>{% block title %}CV Match Scanner{% endblock %}</title>

  <!-- Favicons -->
  <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='apple-touch-icon.png') }}">
  <link rel="icon" type="image/png" sizes="32x32" href="{{ url_for('static', filename='favicon-32x32.png') }}">
  <link rel="icon" type="image/png" sizes="16x16" href="{{ url_for('static', filename='favicon-16x16.png') }}">
  <link rel="manifest" href="{{ url_for('static', filename='site.webmanifest') }}">
  <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}">

  <!-- Styles -->
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css" rel="stylesheet">

  <!-- En <head> deja estas reglas -->
  <style>
    /* Fondo minimal: gradiente + grilla sutil */
    :root { --bg1:#f7f9fc; --bg2:#eef3f9; }
    body {
      padding-top: 4.5rem; /* por el navbar fijo */
      background:
        radial-gradient(circle at 25% 10%, rgba(255,255,255,.9) 0 40%, transparent 41%),
        radial-gradient(circle at 75% 0%,  rgba(255,255,255,.8) 0 35%, transparent 36%),
        linear-gradient(180deg, var(--bg1), var(--bg2));
    }
    /* trama de puntos MUY sutil encima */
    body::before{
      content:"";
      position:fixed; inset:0;
      background-image: radial-gradient(#00000010 1px, transparent 1px);
      background-size: 12px 12px;
      pointer-events:none;
    }

    .avatar { width: 36px; height: 36px; border-radius: 50%; object-fit: cover; }
    footer { background: #fff; border-top: 1px solid #dee2e6; padding: 1rem 0; }

    .navbar-brand:focus, .navbar-brand:focus-visible { outline: none !important; box-shadow: none !important; }
    .navbar-brand img { height: 24px; width: auto; display: inline-block; }

    /* === STEPPER HORIZONTAL ================================================== */ 
    .stepper{
      display:flex;
      justify-content:center;
      align-items:center;
      gap:1.25rem;                 /* espacio “visual” entre bloques */
      position:relative;
      padding:.5rem 0;
    }

    .step{
      display:flex;
      flex-direction:column;
      align-items:center;
      text-align:center;
    }

    .step__bullet{
      width:36px; height:36px; border-radius:50%;
      display:grid; place-items:center; font-weight:700;
      background:#f1f3f5; color:#6c757d; border:2px solid #dee2e6;
      transition:all .25s ease;
      box-shadow:0 0 0 0 rgba(13,110,253,0);
    }
    .step--active .step__bullet{
      border-color:#0d6efd; color:#0d6efd; background:#eef5ff;
      box-shadow:0 0 0 6px rgba(13,110,253,.10);
    }
    .step--done .step__bullet{
      background:#0d6efd; color:#fff; border-color:#0d6efd;
    }
    .step__label{ margin-top:.35rem; font-size:.9rem; color:#495057; }

    /* Conectores: ancho fijo + solape para “tocar” los círculos */
    .stepper-connector{
      height:4px;
      width:80px;                    /* largo del tramo */
      border-radius:4px;
      background:#e9ecef;
      align-self:center;
      transition:background-color .25s ease, opacity .25s ease;
      opacity:.95;

      /* solapa 18px en cada lado (la mitad del radio del bullet) */
      margin:0 -18px;
    }
    .stepper-connector.is-done{   background:#0d6efd66; }
    .stepper-connector.is-active{ background:#0d6efd; }

    @media (max-width: 576px){
      .stepper{ gap:.75rem; }
      .stepper-connector{ width:56px; margin:0 -16px; }
    } 
    /* FIN STEPPER HORIZONTAL ================================================== */

    /* Línea gris finita bajo el stepper (opcional) */
    .stepper-divider{ border-top: 1px solid #e9ecef; margin-top: .25rem; }

    /* === IGUALAR ALTURAS DE LOS DOS PANELES ================================= */
    .equal-panels.row{ align-items: stretch; }
    .equal-panels .card{ height: 100%; }

    /* Dropzone "OK" visual cuando hay archivo */
    .dropzone.ok{
      border-color: #198754 !important;
      background-color: #e9f7ef;
    }    
  </style>


  {% block extra_head %}{% endblock %}
</head>
<body class="d-flex flex-column min-vh-100">
  <!-- Navbar -->  
  <nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm fixed-top">
    <div class="container">
      <a class="navbar-brand d-flex align-items-center gap-2" href="{{ url_for('main.index') }}">
        <!-- usa tu archivo real: favicon-32x32.png/png en static -->
        <img src="{{ url_for('static', filename='favicon-32x32.png') }}" alt="CV Match Scanner">
        <span class="fw-bold mb-0">CV Match Scanner</span>
      </a>
      <div class="d-flex align-items-center">
        <a class="btn btn-sm btn-outline-primary me-2"
          href="{{ url_for('static', filename='docs/Plantilla_CV_ATS_STAR.docx') }}"
          download>
          <i class="bi bi-file-earmark-word"></i> Plantilla CV ATS
        </a>

        <a class="btn btn-sm btn-outline-dark me-2"
          href="https://youtu.be/4icmc4kkPEY" target="_blank" rel="noopener">
          <i class="bi bi-play-circle" 
            data-bs-toggle="tooltip" 
            data-bs-placement="top" 
            title="Ver video explicativo"></i> ¿Qué es un ATS?
        </a>
        {% if session.get('user_email') %}
          {% if session.get('user_picture') %}
            <img class="avatar me-2" src="{{ session.get('user_picture') }}" alt="avatar">
          {% endif %}
          <span class="me-3 d-none d-md-inline">{{ session.get('user_name') or session.get('user_email') }}</span>

          {# Historial: SOLO admin #}
          {% if config.get('ADMIN_EMAIL') and session.get('user_email') and session.get('user_email')|lower == config.get('ADMIN_EMAIL')|lower %}
            <a class="btn btn-sm btn-outline-secondary me-2" href="{{ url_for('history.history') }}">
              <i class="bi bi-clock-history"></i> Historial
            </a>
            <a class="btn btn-sm btn-outline-dark me-2" href="{{ url_for('admin.panel') }}">
              <i class="bi bi-speedometer2"></i> Admin
            </a>
          {% endif %}

          <a class="btn btn-sm btn-outline-danger" href="{{ url_for('auth.logout') }}">
            <i class="bi bi-box-arrow-right"></i>
          </a>
        {% else %}
          <a class="btn btn-sm btn-outline-primary" href="{{ url_for('auth.login') }}">
            <i class="bi bi-google"></i> Iniciar sesión
          </a>
        {% endif %}
      </div>
    </div>
  </nav>

  <!-- Contenido -->
  <main class="container flex-grow-1">
    {% with messages = get_flashed_messages(with_categories=true) %}
      {% if messages %}
        {% for cat, msg in messages %}
          <div class="alert alert-{{ 'info' if cat=='message' else cat }} alert-dismissible fade show mt-3" role="alert">
            {{ msg }}
            <button type="button" class="btn-close" data-bs-dismiss="alert" aria-label="Cerrar"></button>
          </div>
        {% endfor %}
      {% endif %}
    {% endwith %}

    {% block content %}{% endblock %}
  </main>

  <!-- Footer -->
  <footer>
    <div class="container small text-muted d-flex flex-column flex-md-row justify-content-between align-items-center gap-2">
      <div>
        &copy; {{ current_year }} CV Match Scanner · Desarrollado por Ricardo Carruyo · Versión {{ version }}
      </div>
      <div>
        <i class="bi bi-envelope"></i>
        <a class="text-decoration-none" href="mailto:cvmatchscanner@gmail.com">
          cvmatchscanner@gmail.com
        </a>
      </div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
  {% block extra_js %}{% endblock %}
</body>
</html>
